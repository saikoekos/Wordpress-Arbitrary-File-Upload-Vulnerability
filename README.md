# Week 3: Engineering

## Exploit

Exploit Name: Arbitrary File Upload Vulnerability in Wordpress Dreamwork Gallery Plugin

Summary: For this exploit we are going to demonstrate how wordpress websites with the [wp-dreamworkgallery](https://wordpress.org/plugins/wp-dreamworkgallery/) plugin are vulnerable to arbitrary file uploads.

My Contributions: This vulnerability was already discovered around June 2016, but my post here today is going to share a python script written by myself that is capable of exploiting this vulnerability and confirming whether or not the exploit was a success.

Prior Work: Everything made here was based solely off the work found in the three links provied
https://www.youtube.com/watch?v=Zq3IJISrV7I
https://pastebin.com/80tWC6Gd
https://www.pluginvulnerabilities.com/2016/06/07/arbitrary-file-upload-vulnerability-in-wp-dreamwork-gallery/

## Setting up the target

In order to begin, we are going to have to first setup our target. 
For my target I used an ec2 free tier instance from [AWS](https://aws.amazon.com/) running Ubuntu V. 16.04
If you want to follow along with an AWs instance (or any instance from any other service) ensure that your network settings allow incoming traffic. You could specify specific rules, but demonstration I'm just going to allow all traffic.

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git1.JPG' width='' alt='1' />
<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git2.JPG' width='' alt='2' />

Once you have your instance ready and you're inside and at the terminal, let's go ahead and begin setup with

```
$ git clone https://github.com/Dam530/CyberSecurity2_Week3.git
```

Now still from your current directory, let's run

```
? chmod +x ./CyberSecurity2_Week3/init.sh
? ./CyberSecurity2_Week3/init.sh
```

Continue? Y
Continue? Y
mysql password: toor12345
confirm: toor12345
Continue? Y
Enter Password For User Root: toor12345
N
N
Y
Y
Y
Y
All Done!

After going through the initialization, there's just a couple more things we need to do!
Let's get our mysql database going with

```
? mysql -u root -p 
Enter Password: toor12345
...
...
mysql> CREATE DATABASE wp_myblog;
mysql> GRANT ALL PRIVILEGES ON wp_myblog.* TO 'root'@'localhost' IDENTIFIED BY 'toor12345';
mysql> FLUSH PRIVILEGES;
mysql> EXIT;
```

ONLY FOLLOW THIS NEXT STEP IF YOU DID NOT USE THE FOLLOWING MYSQL CREDENTIALS
username: root
password: toor12345

```
? cd /var/www/html
? vim wp-config.php
```

Inside here, ensure these settings are correct

```
define('DB_NAME', '[YOUR_DATABASE_NAME]')
define('DB_USER', '[YOUR DATABASE USER]')
define('DB_PASSWORD', '[YOUR DATABASE PASSWORD]')
```

Go ahead and save those adjustments if you needed to make them and let's get wordpress up and running.
Let's go ahead and grab our public IP with

```
? curl -s checkip.dyndns.org | sed -e 's/.*Current IP Address: //' -e 's/<.*$//'
18.220.50.103	
```

In my case, my public IP is [18.220.50.103]. Assuming that you don't have browser access if you are SSH'ed into your instance, we can use this IP to access our WP from our local machine. 

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git3.JPG' width='' alt='3' />

Let's use the following settings

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git4.JPG' width='' alt='4' />

Afterwards, login and access the Plugins page and activate "Dreamwork Gallery" plugin that should already be installed.

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git5.JPG' width='' alt='5' />

Next, let's publish a new post like this

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git6.JPG' width='' alt='6' />

Now go to the post and ensure that the XML entity runs (it should be blank like shown in the following image).

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git7.JPG' width='' alt='7' />

GREAT! Now our target is ready to be attacked. Let's go and setup our attacker.

## Setting up for the attack

For this section, I used a Kali Linux VM. Honestly, I'm pretty sure any form of linux vm that is capable of running python3 on it should suffice.

Booting into my Kali VM, I'm going to start by cloning this repo again.

```
$ git clone https://github.com/Dam530/CyberSecurity2_Week3.git
```

Excellent, now let's navigate over to my very much appropriately named folder where the exploit is located

```
? cd CyberSecurity2_Week3/l33tHax
```

For the remainder of this walkthrough, I am going to finish this section up in a usage overview.

## Exploit Usage

In order to use this exploit, we are going to need a target. In our case, we are going to want to use the public IP address of the target that we setup to be attacked earlier. In my case, I will be attacking: 18.220.50.103

To begin let's execute the following being sure to replace [TARGET] with our target's IP.

```
? python3 hax.py -t [TARGET]
```

Once the script executes, your browser will soon open to an html page. Inside here you will need to select "Browse" and upload select the file you wish to be uploaded. I've included a file that you can upload and it is...
```
CyberSecurity2_Week3/l33tHax/payload.html
```
Once you upload this file, the script will soon after detect whether the payload has landed or not. Assuming you followed this walkthrough exactly, it should land and give you an address that you can visit to see your file uploaded onto the wordpress.

You can also check your wordpress instance and can confirm that the file has been uploaded there as well within
```
var/www/html/wp-content/uploads/dreamwork/#_uploadfolder
```

Here is a demonstration gif of the script in action

<img src='https://github.com/Dam530/CyberSecurity2_Week3/blob/master/readme_resources/git8.gif' width='' alt='8' />
